<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自我评估系统（Web版）</title>

    <!-- 样式 -->
    <link rel="stylesheet" href="style.css">

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Service Worker 注册 -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>
</head>

<body>

    <h1>自我评估系统（Web 版）</h1>

    <!-- 记录卡片 -->
    <div class="card">
        <h2>记录你的状态</h2>

        <label>情绪：</label>
        <select id="mood">
            <option value="focus">专注</option>
            <option value="calm">平静</option>
            <option value="anxious">焦虑</option>
            <option value="stress">压力</option>
            <option value="out_of_control">失控</option>
        </select>

        <label>你现在在做什么？</label>
        <input id="doing" type="text" placeholder="例如：学习、发呆、摸鱼……">

        <label>这是你当前最有价值的事吗？</label>
        <input id="valuable" type="text" placeholder="例如：是 / 不是 / 一般">

        <button id="saveBtn">保存记录</button>
        <button id="feedbackBtn" style="background:#16a34a;">生成反馈</button>

        <hr style="margin:18px 0;">

        <h3>监控与提醒</h3>
        <button id="startMonitorBtn" style="background:#2563eb;">开始监控（交给系统日历）</button>
        <button id="stopMonitorBtn" style="background:#6b7280;">停止监控</button>

        <p id="monitorStatus" style="margin-top:8px;color:#374151;">
            当前监控状态：未开启
        </p>

        <hr style="margin:18px 0;">

        <!-- 安装为 PWA 应用 -->
        <button id="installBtn"
            style="width:100%;padding:12px;background:#10b981;color:white;border:none;border-radius:6px;margin-top:16px;display:none;">
            安装为应用（APP）
        </button>
    </div>

    <!-- 系统反馈 -->
    <div class="card">
        <h2>系统反馈</h2>
        <div id="feedbackText" style="white-space:pre-line; font-size:16px;"></div>
    </div>

    <!-- 历史记录 -->
    <div class="card">
        <h2>历史记录</h2>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>时间</th>
                    <th>情绪</th>
                    <th>行为</th>
                    <th>是否最有价值</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- PWA 安装脚本 -->
    <script>
        let deferredPrompt = null;

        window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById("installBtn").style.display = "block";
        });

        document.getElementById("installBtn").onclick = async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt = null;
            document.getElementById("installBtn").style.display = "none";
        };
    </script>

    <!-- 主逻辑 -->
    <script src="app.js"></script>
</body>
</html>
